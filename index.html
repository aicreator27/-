<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘èç´ é¤Šç‰¹è¨“ç­ | è§€å¿µ x å¯¦æˆ°æ¨¡æ“¬</title>
    <style>
        :root {
            --primary: #0f766e;
            --secondary: #115e59;
            --accent: #f59e0b;
            --bg: #f0fdfa;
            --text: #134e4a;
            --sidebar-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); display: flex; min-height: 100vh; overflow-x: hidden; }

        /* --- å´é‚Šæ¬„ --- */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            padding: 20px;
            border-right: 1px solid #ccfbf1;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 10;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-sub { font-size: 0.8rem; color: #64748b; margin-bottom: 30px; padding-left: 5px; }

        .module-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
            color: #64748b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid transparent;
        }

        .module-item:hover { background: #f0fdfa; color: var(--primary); }
        .module-item.active { background: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(15, 118, 110, 0.3); }

        /* --- ä¸»å…§å®¹å€ --- */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px;
            max-width: 1200px;
            padding-bottom: 100px;
        }

        .header-section { margin-bottom: 30px; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .header-section h2 { font-size: 2rem; margin-bottom: 15px; color: var(--primary); }
        .header-section p { color: #475569; line-height: 1.8; }

        /* --- å¡ç‰‡ç¶²æ ¼ --- */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .flashcard {
            background: white;
            height: 220px;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 2px solid #f0fdfa;
            display: flex;
            flex-direction: column;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .flashcard:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: var(--primary); }
        
        .tag {
            font-size: 0.75rem;
            padding: 6px 12px;
            background: #ccfbf1;
            color: var(--primary);
            border-radius: 20px;
            width: fit-content;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .click-hint {
            margin-top: auto;
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- AI å€å¡Š --- */
        .ai-panel {
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(to right, #e0f2fe, #f0f9ff);
            border-radius: 16px;
            border: 2px dashed #0284c7;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }

        /* --- è©³æƒ…å½ˆçª— (Modal) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            border-radius: 15px;
            padding: 0;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalIn 0.3s ease-out;
        }

        .modal-header {
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            line-height: 1.8;
            color: #334155;
        }

        .close-btn { background: none; border: none; font-size: 2rem; cursor: pointer; color: #94a3b8; line-height: 1; }
        .close-btn:hover { color: #ef4444; }

        .detail-block { margin-bottom: 25px; }
        .detail-title { font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }

        /* --- éŠæˆ²æ¨¡æ“¬å™¨ --- */
        .game-panel {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 20px;
            padding: 40px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            padding-bottom: 20px;
            border-bottom: 2px solid #334155;
            margin-bottom: 30px;
        }
        
        .status-val { font-size: 1.5rem; font-weight: bold; }
        .status-val.money { color: #facc15; }
        
        .scene-content { flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .scene-icon { font-size: 5rem; margin-bottom: 20px; }
        .scene-text { font-size: 1.3rem; margin-bottom: 40px; line-height: 1.6; }

        .choice-btn {
            width: 100%;
            max-width: 600px;
            padding: 15px 20px;
            margin: 10px auto;
            background: transparent;
            border: 2px solid #f59e0b;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            text-align: left;
            transition: 0.2s;
        }
        .choice-btn:hover { background: #f59e0b; color: #1e293b; transform: translateX(5px); }

        /* RWD */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 20px; }
        }

        @keyframes modalIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand">ğŸš€ è²¡å¯Œç‰¹è¨“ç­</div>
        <div class="brand-sub">å¾è§€å¿µåˆ°æ¨¡æ“¬å¯¦æˆ°</div>
        <ul id="moduleList"></ul>
    </nav>

    <main class="main-content">
        <div id="contentArea"></div>

        <div class="ai-panel" id="aiPanel">
            <h3 style="color:#0369a1; display:flex; align-items:center; gap:10px;">
                ğŸ¤– AI æŠ•è³‡é¡§å• <span style="font-size:0.8rem; color:#64748b; font-weight:normal;">(Powered by Gemini 3 Flash)</span>
            </h3>
            <textarea id="userPrompt" style="width: 100%; height: 80px; margin: 15px 0; padding: 10px; border:1px solid #bae6fd; border-radius:8px;" placeholder="è¼¸å…¥ä½ çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šä»€éº¼æ˜¯æ©Ÿæœƒæˆæœ¬ï¼Ÿæˆ‘è©²æ€éº¼é…ç½®è³‡ç”¢ï¼Ÿ"></textarea>
            <button onclick="askGemini()" style="background: #0284c7; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight:bold;">ç™¼é€è«‹æ±‚</button>
            
            <div id="aiResponse" style="margin-top: 15px; color: #334155; white-space: pre-wrap; display: none; background:white; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                æ­£åœ¨åˆ†æä¸­...
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="detailModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 style="font-size:1.5rem; color:var(--primary);" id="modalTitle">æ¨™é¡Œ</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // --- ğŸ”´ API KEY è¨­å®š ---
        const API_KEY = "AIzaSyBhTKeTX_Eoy-ynJEEoahteTWxYOB0Kgjw"; 

        // --- è³‡æ–™åº«ï¼šèª²ç¨‹ + éŠæˆ²åŠ‡æœ¬ ---
        const curriculum = [
            {
                id: 1,
                type: 'study',
                title: "ç¬¬ä¸€é€±ï¼šç†è²¡åŸºæœ¬åŠŸ",
                desc: "åœ¨æŠ•è³‡ä¹‹å‰ï¼Œå…ˆå­¸æœƒå®ˆä½éŒ¢ã€‚äº†è§£æœƒè¨ˆåŸºç¤èˆ‡å‚µå‹™ç®¡ç†ã€‚",
                cards: [
                    { title: "æç›Šè¡¨ (P&L)", tag: "æœƒè¨ˆ", details: [{sub:"å®šç¾©", txt:"æç›Š = ç‡Ÿæ”¶ - æˆæœ¬ã€‚"}, {sub:"æ‡‰ç”¨", txt:"å¦‚æœä½ çš„æœˆè–ªæ‰£æ‰èŠ±è²»æ˜¯è² çš„ï¼Œä»£è¡¨ä½ åœ¨åƒè€æœ¬ã€‚"}] },
                    { title: "ç·Šæ€¥å‚™ç”¨é‡‘", tag: "é˜²ç¦¦", details: [{sub:"å®šç¾©", txt:"å­˜ä¸‹ 3-6 å€‹æœˆçš„å¿…è¦ç”Ÿæ´»è²»ã€‚"}, {sub:"ç›®çš„", txt:"å¤±æ¥­æˆ–ç”Ÿç—…æ™‚çš„æ•‘å‘½éŒ¢ï¼Œçµ•ä¸èƒ½æ‹¿å»æŠ•è³‡ã€‚"}] },
                    { title: "å¥½å‚µ vs å£å‚µ", tag: "å‚µå‹™", details: [{sub:"å£å‚µ", txt:"å¡å‚µã€ä¿¡è²¸è²·å¥¢ä¾ˆå“ã€‚è®“ä½ è¶Šä¾†è¶Šçª®ã€‚"}, {sub:"å¥½å‚µ", txt:"æˆ¿è²¸ã€å­¸è²¸ã€‚èƒ½æŠ—é€šè†¨æˆ–æå‡æœªä¾†æ”¶å…¥ã€‚"}] }
                ]
            },
            {
                id: 2,
                type: 'study',
                title: "ç¬¬äºŒé€±ï¼šé‡‘èå¸‚å ´èˆ‡å·¥å…·",
                desc: "èªè­˜è¶…å¸‚è£¡è³£ä»€éº¼èœï¼šè‚¡ç¥¨ã€å‚µåˆ¸èˆ‡åŸºé‡‘ã€‚",
                cards: [
                    { title: "è‚¡ç¥¨", tag: "é«˜é¢¨éšª", details: [{sub:"å®šç¾©", txt:"æ“æœ‰å…¬å¸ä¸€éƒ¨åˆ†æ‰€æœ‰æ¬Šã€‚"}, {sub:"ç²åˆ©", txt:"è³ºè‚¡åƒ¹åƒ¹å·® + è‚¡åˆ©åˆ†ç´…ã€‚"}] },
                    { title: "å‚µåˆ¸", tag: "ä½é¢¨éšª", details: [{sub:"å®šç¾©", txt:"å€ŸéŒ¢çµ¦æ”¿åºœæˆ–å…¬å¸ï¼Œå°æ–¹ä»˜ä½ åˆ©æ¯ã€‚"}, {sub:"åŠŸèƒ½", txt:"è³‡ç”¢é…ç½®ä¸­çš„å®‰å…¨æ°£å›Šã€‚"}] },
                    { title: "ETF", tag: "æ–°æ‰‹æ¨è–¦", details: [{sub:"å®šç¾©", txt:"ä¸€ç±ƒå­è‚¡ç¥¨ã€‚è²·0050ç­‰æ–¼è²·ä¸‹å…¨å°ç£æœ€å¤§çš„50å®¶å…¬å¸ã€‚"}, {sub:"å„ªé»", txt:"è‡ªå‹•åˆ†æ•£é¢¨éšªï¼Œä¸ç”¨é¸è‚¡ã€‚"}] }
                ]
            },
            {
                id: 3,
                type: 'study',
                title: "ç¬¬ä¸‰é€±ï¼šæ·±å…¥åŸºæœ¬é¢",
                desc: "ã€é€²éšã€‘å¦‚ä½•åˆ¤æ–·ä¸€å®¶å…¬å¸çœŸæ­£çš„åƒ¹å€¼ï¼Ÿ",
                cards: [
                    { title: "æœ¬ç›Šæ¯” (PE)", tag: "ä¼°å€¼", details: [{sub:"å…¬å¼", txt:"è‚¡åƒ¹ / EPSã€‚"}, {sub:"æ„ç¾©", txt:"è²·é€²é€™å®¶å…¬å¸ï¼Œå¤§æ¦‚è¦å¹¾å¹´æ‰èƒ½å›æœ¬ï¼Ÿ"}] },
                    { title: "æ·¨å€¼ (Book Value)", tag: "é«”è³ª", details: [{sub:"å…¬å¼", txt:"è³‡ç”¢ - è² å‚µã€‚"}, {sub:"æ„ç¾©", txt:"å…¬å¸æ¸…ç®—å¾Œè‚¡æ±èƒ½æ‹¿å›å¤šå°‘éŒ¢ã€‚"}] },
                    { title: "æ®–åˆ©ç‡", tag: "é…æ¯", details: [{sub:"å…¬å¼", txt:"è‚¡åˆ© / è‚¡åƒ¹ã€‚"}, {sub:"é™·é˜±", txt:"ä¸è¦åªçœ‹é«˜æ®–åˆ©ç‡ï¼Œè¦çœ‹å¡«æ¯èƒ½åŠ›ã€‚"}] }
                ]
            },
            {
                id: 4,
                type: 'study',
                title: "ç¬¬å››é€±ï¼šå¯Œäººçš„æ€ç¶­æ¨¡å‹ (ESBI)",
                desc: "ç‚ºä»€éº¼åŠªåŠ›å·¥ä½œä¸ä¸€å®šæœƒè®Šæœ‰éŒ¢ï¼Ÿå› ç‚ºä½ è™•åœ¨éŒ¯èª¤çš„è±¡é™ã€‚",
                cards: [
                    {
                        title: "ESBI è±¡é™",
                        tag: "ç¾…ä¼¯ç‰¹Â·æ¸…å´",
                        details: [
                            { sub: "E (é›‡å“¡)", txt: "ç”¨æ™‚é–“æ›éŒ¢ï¼Œæ‰‹åœå£åœã€‚" },
                            { sub: "S (è‡ªåƒ±è€…)", txt: "ç”¨å°ˆæ¥­æ›éŒ¢ï¼Œä¾ç„¶æ˜¯è‡ªå·±æ‰“å·¥ã€‚" },
                            { sub: "B (ä¼æ¥­ä¸»)", txt: "ç”¨ç³»çµ±è³ºéŒ¢ï¼Œé›¢é–‹å…¬å¸ä¾ç„¶åœ¨é‹è½‰ã€‚" },
                            { sub: "I (æŠ•è³‡è€…)", txt: "ç”¨éŒ¢è³ºéŒ¢ï¼ŒæŒ‡æ•¸ç´šå¢é•·ã€‚" }
                        ]
                    },
                    {
                        title: "çª®äºº vs å¯Œäººæ€ç¶­",
                        tag: "å¿ƒæ…‹",
                        details: [
                            { sub: "é‡‘éŒ¢è§€", txt: "çª®äººæƒ³è‘—æ€éº¼èŠ±éŒ¢ï¼Œå¯Œäººæƒ³è‘—æ€éº¼è®“éŒ¢ç”ŸéŒ¢ (ROI)ã€‚" },
                            { sub: "é¢¨éšªè§€", txt: "çª®äººå®³æ€•é¢¨éšªé¸å®‰ç©©ï¼Œå¯Œäººç®¡ç†é¢¨éšªæ‰¾æ©Ÿæœƒã€‚" }
                        ]
                    },
                    {
                        title: "æ©Ÿæœƒæˆæœ¬",
                        tag: "æ±ºç­–",
                        details: [
                            { sub: "å®šç¾©", txt: "ç‚ºäº†é¸æ“‡ A è€Œå¿…é ˆæ”¾æ£„çš„ B çš„åƒ¹å€¼ã€‚" },
                            { sub: "ä¾‹å­", txt: "èŠ±æ™‚é–“æ’éšŠè²·æ‹‰éºµï¼Œæˆæœ¬ä¸åªæ˜¯éŒ¢ï¼Œé‚„æœ‰ä½ çš„æ™‚é–“åƒ¹å€¼ã€‚" }
                        ]
                    }
                ]
            },
            {
                id: 5,
                type: 'study',
                title: "ç¬¬äº”é€±ï¼šè¡Œç‚ºé‡‘èå­¸",
                desc: "è³ éŒ¢é€šå¸¸æ˜¯å› ç‚ºå¿ƒç†ç´ è³ªã€‚Debug äººé¡å¤§è…¦çš„åŸå§‹è¨­å®šã€‚",
                cards: [
                    { title: "æå¤±è¶¨é¿", tag: "Bug", details: [{ sub: "ç¾è±¡", txt: "è³ éŒ¢çš„ç—›è‹¦æ˜¯è³ºéŒ¢å¿«æ¨‚çš„ 2 å€ã€‚" }, { sub: "å¾Œæœ", txt: "æ•£æˆ¶å¾€å¾€å¤ªæ—©è³£æ‰è³ºéŒ¢è‚¡ï¼Œæ­»æŠ±è‘—è³ éŒ¢è‚¡ã€‚" }] },
                    { title: "æ²ˆæ²’æˆæœ¬", tag: "é™·é˜±", details: [{ sub: "å®šç¾©", txt: "å·²ç™¼ç”Ÿç„¡æ³•å›æ”¶çš„æˆæœ¬ã€‚" }, { sub: "ç­–ç•¥", txt: "æ±ºç­–åªçœ‹æœªä¾†ï¼Œä¸çœ‹éå»è³ äº†å¤šå°‘ã€‚" }] },
                    { title: "ç¢ºèªåèª¤", tag: "åŒæº«å±¤", details: [{ sub: "ç¾è±¡", txt: "åªçœ‹è´ŠåŒè‡ªå·±çš„æ–°èï¼Œç„¡è¦–åˆ©ç©ºã€‚" }, { sub: "å±éšª", txt: "å°é¡¯è€Œæ˜“è¦‹çš„é¢¨éšªè¦–è€Œä¸è¦‹ã€‚" }] }
                ]
            },
            {
                id: 6,
                type: 'study',
                title: "ç¬¬å…­é€±ï¼šé€±æœŸçš„åŠ›é‡",
                desc: "å¸‚å ´åƒå‘¼å¸ä¸€æ¨£æœ‰é€±æœŸã€‚æ²’ä»€éº¼æ˜¯ç¢ºå®šçš„ï¼Œé™¤äº†é€±æœŸã€‚",
                cards: [
                    { title: "é˜æ“ºç†è«–", tag: "éœè¯Â·é¦¬å…‹æ–¯", details: [{ sub: "æ¦‚å¿µ", txt: "å¸‚å ´æƒ…ç·’æ°¸é åœ¨æ¥µåº¦æ¨‚è§€èˆ‡æ‚²è§€é–“æ“ºç›ªã€‚" }, { sub: "æ‡‰ç”¨", txt: "äººæ£„æˆ‘å–ï¼Œäººå–æˆ‘èˆ‡ã€‚" }] },
                    { title: "å‡å€¼å›æ­¸", tag: "æ•¸å­¸æ³•å‰‡", details: [{ sub: "å®šç¾©", txt: "æ¼²å¤šå¿…è·Œï¼Œè·Œå¤šå¿…æ¼²ã€‚" }, { sub: "ç­–ç•¥", txt: "ä¸è¦è¿½é«˜ä¹–é›¢ç‡éå¤§çš„è³‡ç”¢ã€‚" }] },
                    { title: "é»‘å¤©éµ vs ç°çŠ€ç‰›", tag: "é¢¨éšª", details: [{ sub: "é»‘å¤©éµ", txt: "æ©Ÿç‡å°è¡æ“Šå¤§ (å¦‚ç–«æƒ…)ã€‚" }, { sub: "ç°çŠ€ç‰›", txt: "é¡¯è€Œæ˜“è¦‹å»è¢«å¿½è¦–çš„é¢¨éšª (å¦‚æ³¡æ²«)ã€‚" }] }
                ]
            },
            {
                id: 7,
                type: 'game', 
                title: "ç¬¬ä¸ƒé€±ï¼šäººç”Ÿæ¨¡æ“¬å¯¦æˆ° (æœ€çµ‚è©¦ç…‰)",
                desc: "æ¨¡æ“¬æœªä¾† 10 å¹´çš„æ±ºç­–ï¼Œçœ‹çœ‹ä½ æ˜¯å¦èƒ½é¿é–‹äººæ€§é™·é˜±ï¼Œå¯¦ç¾è²¡å¯Œè‡ªç”±ã€‚",
                startScene: 'start'
            }
        ];

        // --- éŠæˆ²è…³æœ¬ ---
        const gameScenes = {
            'start': {
                icon: 'ğŸ“', text: 'å‰›ç•¢æ¥­èµ·è–ª 3.5 è¬ï¼Œæ‰‹ä¸Šæœ‰ 10 è¬ç©è“„ã€‚ç¬¬ä¸€å€‹æœˆç™¼è–ªæ°´æ€éº¼è¾¦ï¼Ÿ',
                choices: [
                    { txt: 'è²· iPhoneã€åƒå¤§é¤ (èŠ±æ‰ 3 è¬)', next: 'scene_2', money: -30000, msg: 'äº«å—ç•¶ä¸‹ï¼Œä½†ç©è“„ç¬é–“å°‘äº† 30%ã€‚' },
                    { txt: 'åŸ·è¡Œ 631 æ³•å‰‡ (å­˜ä¸‹ 30%)', next: 'scene_2', money: 5000, msg: 'å¿ä½æ…¾æœ›ï¼Œå­˜ä¸‹ç¬¬ä¸€æ¡¶é‡‘ã€‚' }
                ]
            },
            'scene_2': {
                icon: 'ğŸš—', text: '25 æ­²ï¼ŒåŒäº‹éƒ½è²·è»Šäº†ï¼Œä½ ä¹Ÿæƒ³è²·ä¸€å° 70 è¬çš„æ–°è»Šã€‚',
                choices: [
                    { txt: 'è²·ï¼åˆ†æœŸä»˜æ¬¾ä¹Ÿè¦è²·', next: 'car_path', money: -200000, msg: 'è²·äº†æ–°è»Šï¼ä½†æ¯å€‹æœˆå¤šäº†è»Šè²¸é¤Šè»Šè²»ï¼Œç¾é‡‘æµåƒç·Šã€‚' },
                    { txt: 'å¿ä½ï¼Œé¨æ©Ÿè»Šï¼ŒéŒ¢æ‹¿å»æŠ•è³‡', next: 'invest_path', money: 0, msg: 'é¿é–‹äº†è² å‚µï¼Œä¿ç•™æŠ•è³‡æœ¬é‡‘ã€‚' }
                ]
            },
            'car_path': {
                icon: 'ğŸ“‰', text: 'è²·è»Šå¾Œä¸€å¹´è¢«è£å“¡ï¼å¤±å»æ”¶å…¥ä½†è»Šè²¸ç…§ç¹³ã€‚',
                choices: [
                    { txt: 'æ²’å‚™ç”¨é‡‘ï¼Œåªèƒ½ä¿¡è²¸', next: 'bad_end', money: -100000, msg: 'å‚µå‹™è¶Šæ»¾è¶Šå¤§ã€‚' },
                    { txt: 'å¿ç—›è³£è»Šæ±‚ç¾', next: 'scene_3', money: 400000, msg: 'æ–°è»Šè½åœ°æ‰“æŠ˜ï¼Œè™§äº†å¹¾åè¬ä½†è§£æ±ºå±æ©Ÿã€‚' }
                ]
            },
            'invest_path': {
                icon: 'ğŸ“ˆ', text: 'éŒ¢æŠ•å…¥è‚¡å¸‚ï¼Œçµæœé‡åˆ°é‡‘èæµ·å˜¯ï¼Œå¸³é¢è™§æ 40%ï¼',
                choices: [
                    { txt: 'åš‡æ­»äº†ï¼Œè³£æ‰æ­¢æ (æå¤±è¶¨é¿)', next: 'scene_3', money: -100000, msg: 'åœ¨æœ€ä½é»è³£å‡ºï¼Œå¯¦ç¾è™§æã€‚' },
                    { txt: 'ç›¸ä¿¡åŸºæœ¬é¢ï¼Œç¹¼çºŒæŒæœ‰', next: 'rich_path', money: 0, msg: 'å¿ä½ææ…Œã€‚å…©å¹´å¾Œå¸‚å ´åå½ˆè³‡ç”¢ç¿»å€ã€‚' }
                ]
            },
            'rich_path': {
                icon: 'ğŸ’°', text: '35 æ­²ï¼Œè³‡ç”¢çªç ´ 500 è¬ã€‚é€™æ™‚æ–°èç‹‚å ±ã€Œå…¨çƒç¶“æ¿Ÿå´©ç›¤ã€...',
                choices: [
                    { txt: 'æˆ‘æœ‰åšè³‡ç”¢é…ç½®ï¼Œä¸ç†æœƒ', next: 'market_crash_test', money: 0, msg: 'æº–å‚™å¥½è¿æ¥è€ƒé©—å§ã€‚' }
                ]
            },
            'market_crash_test': {
                icon: 'ğŸ“‰', text: 'ã€ç³»çµ±å»£æ’­ã€‘å²è©©ç´šå´©ç›¤ï¼ä½ çš„æœ‹å‹éƒ½åœ¨æ‹‹å”®ï¼Œä½ è©²æ€éº¼è¾¦ï¼Ÿ',
                choices: [
                    { txt: 'è·Ÿè‘—è³£æ‰ (å¾çœ¾å¿ƒç†)', next: 'panic_sell', money: -500000, msg: 'ä½ å› ç‚ºææ…Œè€Œè³£åœ¨ä½é»ã€‚' },
                    { txt: 'å‹•ç”¨å‚™ç”¨é‡‘åŠ ç¢¼ (è²ªå©ª)', next: 'aggressive_buy', money: 0, msg: 'å¤§è†½æ¥åˆ€ï¼Œé¢¨éšªæ¥µé«˜ã€‚' },
                    { txt: 'é—œæ‰æ–°èï¼Œå»æ•£æ­¥ (éˆæ„ŸåŠ›)', next: 'happy_end', money: 200000, msg: 'ä¸€å¹´å¾Œå¸‚å ´å‰µæ–°é«˜ï¼Œä½ ä»€éº¼éƒ½æ²’åšå»è´äº†ã€‚' }
                ]
            },
            'panic_sell': { icon: 'ğŸ’¸', text: 'è³£å…‰å¾Œè‚¡å¸‚ V å‹åè½‰å‰µæ–°é«˜ï¼Œä½ åªèƒ½çœ‹è‘—åˆ¥äººè³ºéŒ¢ã€‚', choices: [{ txt: 'å­¸åˆ°ä¸€èª²', next: 'start', money: 0, msg: 'é€™å ‚èª²å¾ˆè²´ã€‚' }] },
            'aggressive_buy': { icon: 'ğŸ°', text: 'é‹æ°£å¥½å¸‚å ´è¦‹åº•ï¼Œä½ å¤§è³ºä¸€ç­†ã€‚ä½†ä¸‹æ¬¡å¯èƒ½å°±æ²’é€™éº¼å¥½é‹ã€‚', choices: [{ txt: 'è¦‹å¥½å°±æ”¶', next: 'happy_end', money: 1000000, msg: 'å¯Œè²´éšªä¸­æ±‚ã€‚' }] },
            'scene_3': { icon: 'ğŸ˜', text: '35 æ­²ï¼Œè³‡ç”¢å¹³å¹³ã€‚', choices: [{ txt: 'é‡æ–°é–‹å§‹', next: 'start', money: 0, msg: 'é‡ä¾†ä¸€æ¬¡ã€‚' }] },
            'bad_end': { icon: 'ğŸ’¸', text: 'ç ´ç”¢çµå±€ã€‚', choices: [{ txt: 'é‡æ–°æŒ‘æˆ°', next: 'start', money: 0, msg: 'è¨˜å¾—å­˜å‚™ç”¨é‡‘ï¼' }] },
            'happy_end': { icon: 'ğŸ†', text: 'è²¡å¯Œè‡ªç”±çµå±€ï¼ä½ å…‹æœäº†äººæ€§ï¼Œè®“è¤‡åˆ©ç‚ºä½ å·¥ä½œã€‚', choices: [{ txt: 'å†ç©ä¸€æ¬¡', next: 'start', money: 0, msg: 'æ­å–œï¼' }] }
        };

        // --- æ ¸å¿ƒé‚è¼¯ ---
        let currentModuleId = 1;
        let gameState = { money: 100000, scene: 'start' };

        function init() {
            renderSidebar();
            loadModule(1);
        }

        function renderSidebar() {
            const list = document.getElementById('moduleList');
            list.innerHTML = '';
            curriculum.forEach(mod => {
                const li = document.createElement('li');
                li.className = `module-item ${mod.id === currentModuleId ? 'active' : ''}`;
                li.innerHTML = `<span>${mod.title}</span>`;
                li.onclick = () => loadModule(mod.id);
                list.appendChild(li);
            });
        }

        function loadModule(id) {
            currentModuleId = id;
            renderSidebar();
            const module = curriculum.find(m => m.id === id);
            const contentDiv = document.getElementById('contentArea');
            const aiPanel = document.getElementById('aiPanel');

            let html = `
                <div class="header-section">
                    <h2>${module.title}</h2>
                    <p>${module.desc}</p>
                </div>
            `;

            if (module.type === 'study') {
                html += `<div class="card-grid">`;
                module.cards.forEach((card, index) => {
                    html += `
                        <div class="flashcard" onclick="openDetail(${id}, ${index})">
                            <span class="tag">${card.tag}</span>
                            <h3 style="font-size:1.4rem; color:#334155;">${card.title}</h3>
                            <div class="click-hint">ğŸ‘† é»æ“Šçœ‹è©³è§£</div>
                        </div>
                    `;
                });
                html += `</div>`;
                aiPanel.style.display = 'block'; // å­¸ç¿’æ¨¡å¼é¡¯ç¤º AI
            } else {
                html += `<div class="game-panel" id="gamePanel"></div>`;
                setTimeout(() => {
                    gameState = { money: 100000, scene: module.startScene };
                    renderGameScene(module.startScene);
                }, 0);
                aiPanel.style.display = 'none'; // éŠæˆ²æ¨¡å¼éš±è— AI (é¿å…ä½œå¼Š)
            }
            contentDiv.innerHTML = html;
        }

        function openDetail(moduleId, cardIndex) {
            const module = curriculum.find(m => m.id === moduleId);
            const card = module.cards[cardIndex];
            document.getElementById('modalTitle').innerText = card.title;
            const body = document.getElementById('modalBody');
            body.innerHTML = '';
            card.details.forEach(detail => {
                body.innerHTML += `
                    <div class="detail-block">
                        <div class="detail-title">ğŸ”¹ ${detail.sub}</div>
                        <div>${detail.txt}</div>
                    </div>
                `;
            });
            document.getElementById('detailModal').style.display = 'flex';
        }

        function closeModal(e) {
            document.getElementById('detailModal').style.display = 'none';
        }

        function renderGameScene(sceneId) {
            const scene = gameScenes[sceneId];
            const panel = document.getElementById('gamePanel');
            if (!panel) return;

            let html = `
                <div class="status-bar">
                    <div>è³‡ç”¢ï¼š<span class="status-val money">$${gameState.money.toLocaleString()}</span></div>
                </div>
                <div class="scene-content">
                    <div class="scene-icon">${scene.icon}</div>
                    <div class="scene-text">${scene.text}</div>
                    <div style="width:100%">
            `;
            scene.choices.forEach(choice => {
                html += `<button class="choice-btn" onclick="makeChoice('${choice.next}', ${choice.money}, '${choice.msg}')">${choice.txt}</button>`;
            });
            html += `</div></div>`;
            panel.innerHTML = html;
        }

        function makeChoice(nextScene, moneyChange, msg) {
            gameState.money += moneyChange;
            alert(msg);
            renderGameScene(nextScene);
        }

        // --- Google Gemini AI ---
        async function askGemini() {
            const input = document.getElementById('userPrompt').value;
            const responseDiv = document.getElementById('aiResponse');
            
            if (!input.trim()) { alert("è«‹è¼¸å…¥å•é¡Œï¼"); return; }

            responseDiv.style.display = 'block';
            responseDiv.innerHTML = "â³ AI æ­£åœ¨æ€è€ƒä¸­...";
            
            // ä½¿ç”¨ Gemini 3 Flash Preview
            const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=" + API_KEY;
            
            const payload = {
                contents: [{
                    parts: [{ text: input + " (è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œä¸¦ä¸”åšç‚ºä¸€å€‹å°ˆæ¥­çš„ç†è²¡é¡§å•ï¼Œå›ç­”ç°¡çŸ­æœ‰åŠ›ä¸¦ç›¡å¯èƒ½å¤šè¦–è§’åˆ†æ)" }]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.candidates && data.candidates[0].content) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    responseDiv.innerHTML = `<strong>ğŸ’¡ é¡§å•å»ºè­°ï¼š</strong><br>${aiText}`;
                } else {
                    responseDiv.innerHTML = "âŒ ç™¼ç”ŸéŒ¯èª¤ (å¯èƒ½å› ç‚ºæ¨¡å‹å¤ªæ–°æˆ–ä¸ç©©å®š)ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
                    console.error("API Error:", data);
                }
            } catch (error) {
                responseDiv.innerHTML = "âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚";
                console.error("Fetch Error:", error);
            }
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
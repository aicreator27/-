<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘èç´ é¤Šç‰¹è¨“ç­ | è§€å¿µ x å¯¦æˆ°æ¨¡æ“¬</title>
    <style>
        :root {
            --primary: #0f766e;
            --secondary: #115e59;
            --accent: #f59e0b;
            --bg: #f0fdfa;
            --text: #134e4a;
            --sidebar-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); display: flex; min-height: 100vh; overflow-x: hidden; }

        /* --- å´é‚Šæ¬„ --- */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            padding: 20px;
            border-right: 1px solid #ccfbf1;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 10;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-sub { font-size: 0.8rem; color: #64748b; margin-bottom: 30px; padding-left: 5px; }

        .module-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
            color: #64748b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid transparent;
        }

        .module-item:hover { background: #f0fdfa; color: var(--primary); }
        .module-item.active { background: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(15, 118, 110, 0.3); }

        /* --- ä¸»å…§å®¹å€ --- */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px;
            max-width: 1200px;
            padding-bottom: 150px;
        }

        .header-section { margin-bottom: 30px; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .header-section h2 { font-size: 2rem; margin-bottom: 15px; color: var(--primary); }
        .header-section p { color: #475569; line-height: 1.8; }

        /* --- å¡ç‰‡ç¶²æ ¼ --- */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .flashcard {
            background: white;
            height: 220px;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 2px solid #f0fdfa;
            display: flex;
            flex-direction: column;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .flashcard:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: var(--primary); }
        
        .tag {
            font-size: 0.75rem;
            padding: 6px 12px;
            background: #ccfbf1;
            color: var(--primary);
            border-radius: 20px;
            width: fit-content;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .click-hint {
            margin-top: auto;
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- å·¥å…·é¢æ¿ (AI + è¨ˆç®—æ©Ÿ) --- */
        .tools-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }

        /* RWD: æ‰‹æ©Ÿç‰ˆè®Šæˆå–®æ¬„ */
        @media (max-width: 900px) {
            .tools-container { grid-template-columns: 1fr; }
        }

        .tool-panel {
            padding: 25px;
            background: white;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }

        .tool-title {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        /* è¨ˆç®—æ©Ÿæ¨£å¼ */
        .calc-input { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 6px; }
        .calc-label { font-size: 0.9rem; color: #64748b; margin-bottom: 4px; display: block; }
        .calc-result { background: #f0fdfa; padding: 15px; border-radius: 8px; text-align: center; margin-top: 10px; }
        .calc-result span { display: block; font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .calc-btn { width: 100%; background: var(--secondary); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .calc-btn:hover { background: var(--primary); }

        /* --- è©³æƒ…å½ˆçª— --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            border-radius: 15px;
            padding: 0;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalIn 0.3s ease-out;
        }

        .modal-header {
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            line-height: 1.8;
            color: #334155;
        }

        .close-btn { background: none; border: none; font-size: 2rem; cursor: pointer; color: #94a3b8; line-height: 1; }
        .close-btn:hover { color: #ef4444; }

        .detail-block { margin-bottom: 25px; }
        .detail-title { font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }

        /* --- éŠæˆ²æ¨¡æ“¬å™¨ --- */
        .game-panel {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 20px;
            padding: 40px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            padding-bottom: 20px;
            border-bottom: 2px solid #334155;
            margin-bottom: 30px;
        }
        
        .status-val { font-size: 1.5rem; font-weight: bold; }
        .status-val.money { color: #facc15; }
        
        .scene-content { flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .scene-icon { font-size: 5rem; margin-bottom: 20px; }
        .scene-text { font-size: 1.3rem; margin-bottom: 40px; line-height: 1.6; }

        .choice-btn {
            width: 100%;
            max-width: 600px;
            padding: 15px 20px;
            margin: 10px auto;
            background: transparent;
            border: 2px solid #f59e0b;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            text-align: left;
            transition: 0.2s;
        }
        .choice-btn:hover { background: #f59e0b; color: #1e293b; transform: translateX(5px); }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 20px; }
        }

        @keyframes modalIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand">ğŸš€ è²¡å¯Œç‰¹è¨“ç­</div>
        <div class="brand-sub">å¾è§€å¿µåˆ°æ¨¡æ“¬å¯¦æˆ°</div>
        <ul id="moduleList"></ul>
    </nav>

    <main class="main-content">
        <div id="contentArea"></div>

        <div class="tools-container" id="toolsPanel">
            
            <div class="tool-panel">
                <div class="tool-title">
                    <span>ğŸ¤– AI æŠ•è³‡é¡§å•</span>
                    <span style="font-size:0.8rem; color:#64748b; font-weight:normal;">(Gemini 1.5 Flash)</span>
                </div>
                <input type="password" id="apiKeyInput" placeholder="åœ¨æ­¤è²¼ä¸Šä½ çš„ API Key (ä¸æœƒè¢«å„²å­˜)" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #f59e0b; border-radius:6px; background:#fffbeb;">
                
                <textarea id="userPrompt" style="width: 100%; height: 100px; padding: 10px; border:1px solid #cbd5e1; border-radius:8px; margin-bottom:10px;" placeholder="è¼¸å…¥å•é¡Œï¼Œä¾‹å¦‚ï¼šä»€éº¼æ˜¯æ©Ÿæœƒæˆæœ¬ï¼Ÿæˆ‘æœ‰ 10 è¬è©²æ€éº¼é…ç½®ï¼Ÿ"></textarea>
                <button onclick="askGemini()" style="width:100%; background: #0284c7; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight:bold;">ç™¼é€è«‹æ±‚</button>
                <div id="aiResponse" style="margin-top: 15px; color: #334155; white-space: pre-wrap; font-size:0.95rem;"></div>
            </div>

            <div class="tool-panel">
                <div class="tool-title">
                    <span>ğŸ›¡ï¸ é¢¨éšªå€‰ä½è¨ˆç®—æ©Ÿ</span>
                </div>
                <div>
                    <label class="calc-label">ç¸½è³‡é‡‘ (NT$)</label>
                    <input type="number" id="totalCapital" class="calc-input" value="100000">
                    
                    <label class="calc-label">å–®ç­†æœ€å¤§è™§æ (%)</label>
                    <input type="number" id="riskPercent" class="calc-input" value="2" placeholder="é€šå¸¸è¨­ 2%">
                    
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1">
                            <label class="calc-label">è²·å…¥åƒ¹</label>
                            <input type="number" id="entryPrice" class="calc-input">
                        </div>
                        <div style="flex:1">
                            <label class="calc-label">åœæåƒ¹</label>
                            <input type="number" id="stopLossPrice" class="calc-input">
                        </div>
                    </div>

                    <button class="calc-btn" onclick="calculatePosition()">è¨ˆç®—å¯è²·è‚¡æ•¸</button>

                    <div class="calc-result">
                        å»ºè­°è‚¡æ•¸ <span id="resultShares">0</span>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div class="modal-overlay" id="detailModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 style="font-size:1.5rem; color:var(--primary);" id="modalTitle">æ¨™é¡Œ</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
    <script>
        // ==========================================
        // ğŸ’€ GOD MODE å®Œæ•´è³‡æ–™åº« (æ¨¡çµ„ 1 ~ 10)
        // ==========================================
        const curriculum = [
            // --- ğŸŸ¢ æ¨¡çµ„ä¸€ï¼šè²¡å ±é‘‘è­˜ ---
            {
                id: 1, type: 'study', title: "æ¨¡çµ„ä¸€ï¼šè²¡å ±é‘‘è­˜ (Forensic Accounting)", desc: "è²¡å ±æ˜¯åˆæ³•çš„è¬Šè¨€ã€‚æˆ‘å€‘ä¸çœ‹åˆ©æ½¤ï¼Œæˆ‘å€‘çœ‹ç¾é‡‘æµå“è³ªèˆ‡è³‡ç”¢è² å‚µè¡¨çš„ç ´ç¶»ã€‚",
                cards: [
                    { 
                        title: "M-Score æ¨¡å‹ (é€ å‡åµæ¸¬)", tag: "é˜²é›·", 
                        intro: "Beneish æ•™æˆé–‹ç™¼çš„çµ±è¨ˆæ¼”ç®—æ³•ã€‚æ•¸å€¼ > -2.22 ä»£è¡¨é«˜æ©Ÿç‡åšå‡å¸³ã€‚",
                        details: [
                            {sub:"DSRI (æ‡‰æ”¶å¸³æ¬¾æŒ‡æ•¸)", txt:"æ‡‰æ”¶å¸³æ¬¾æˆé•·ç‡ >> ç‡Ÿæ”¶æˆé•·ç‡ã€‚å¯èƒ½åœ¨å¡è²¨çµ¦é€šè·¯ (Channel Stuffing)ã€‚"},
                            {sub:"GMI (æ¯›åˆ©æŒ‡æ•¸)", txt:"æ¯›åˆ©ç•°å¸¸æš´å¢ã€‚é™¤éæœ‰æ®ºæ‰‹ç´šæ–°å“ï¼Œå¦å‰‡å¯èƒ½æ˜¯å°‘çµè½‰æˆæœ¬ã€‚"},
                            {sub:"AQI (è³‡ç”¢å“è³ªæŒ‡æ•¸)", txt:"ç„¡å½¢è³‡ç”¢/å•†è­½ä½”æ¯”æš´å¢ã€‚é€™æ˜¯æœ€å®¹æ˜“è—è™§æçš„é»‘ç®±ã€‚"},
                            {sub:"SGI (ç‡Ÿæ”¶æˆé•·æŒ‡æ•¸)", txt:"å®Œç¾ 45 åº¦è§’çš„ç‡Ÿæ”¶æ›²ç·šï¼Œé€šå¸¸æ˜¯äººç‚ºä¿®é£¾çš„çµæœã€‚"}
                        ]
                    },
                    { 
                        title: "ç¾é‡‘å¾ªç’°é€±æœŸ (CCC)", tag: "æ•ˆç‡æ¼”ç®—æ³•", 
                        intro: "è¡¡é‡è³‡é‡‘å‘¨è½‰é€Ÿåº¦ã€‚å…¬å¼ï¼šæ‡‰æ”¶å¤©æ•¸ + å­˜è²¨å¤©æ•¸ - æ‡‰ä»˜å¤©æ•¸ã€‚",
                        details: [
                            {sub:"è² çš„ CCC", txt:"å¦‚ Amazon (-20å¤©)ã€‚å…ˆæ”¶å®¢æˆ¶éŒ¢ï¼Œ90å¤©å¾Œæ‰ä»˜éŒ¢çµ¦å» å•†ã€‚ç”¨ä¾›æ‡‰å•†çš„éŒ¢ç„¡æ¯æ“´å¼µã€‚"},
                            {sub:"æƒ¡åŒ–è¨Šè™Ÿ", txt:"CCC é€å­£æ‹‰é•· = è²¨è³£ä¸æ‰ + éŒ¢æ”¶ä¸å›ä¾†ã€‚é»‘å­—å€’é–‰å‰å…†ã€‚"},
                            {sub:"ç”¢æ¥­å·®ç•°", txt:"SaaS è»Ÿé«”æ¥­ä¸çœ‹ CCCï¼Œçœ‹ã€Œéå»¶æ”¶å…¥ (Deferred Revenue)ã€çš„ç´¯ç©é€Ÿåº¦ã€‚"}
                        ]
                    },
                    { 
                        title: "EBITDA çš„é™·é˜±", tag: "ä¼°å€¼é¨™å±€", 
                        intro: "ç¨…å‰æ¯å‰æŠ˜èˆŠæ”¤éŠ·å‰ç²åˆ©ã€‚å·´è²ç‰¹ç¨±ä¹‹ç‚ºã€Œå»¢è©±æŒ‡æ¨™ã€ã€‚",
                        details: [
                            {sub:"éš±è—æŠ˜èˆŠ", txt:"é‡è³‡ç”¢è¡Œæ¥­ (æ™¶åœ“ã€èˆªé‹) è¨­å‚™æŠ˜èˆŠå·¨å¤§ï¼ŒEBITDA æœƒåš´é‡é«˜ä¼°ç²åˆ©ã€‚"},
                            {sub:"éš±è—åˆ©æ¯", txt:"æ®­å±ä¼æ¥­ EBITDA ç‚ºæ­£ï¼Œä½†ä»˜å®Œåˆ©æ¯å¾Œæ·¨åˆ©ç‚ºè² ã€‚"},
                            {sub:"æ­£ç¢ºç”¨æ³•", txt:"åƒ…é©ç”¨æ–¼åˆæœŸç‡’éŒ¢å¿«ã€ä½†é‚Šéš›æˆæœ¬æ¥µä½çš„ç´”è»Ÿé«”å…¬å¸ã€‚"}
                        ]
                    },
                    { 
                        title: "è‡ªç”±ç¾é‡‘æµ (FCF)", tag: "çœŸé‡‘ç™½éŠ€", 
                        intro: "FCF = ç‡Ÿé‹ç¾é‡‘æµ - è³‡æœ¬æ”¯å‡ºã€‚è‚¡æ±çœŸæ­£èƒ½åˆ†åˆ°çš„éŒ¢ã€‚",
                        details: [
                            {sub:"FCF Yield", txt:"FCF / å¸‚å€¼ã€‚è‹¥ > ç„¡é¢¨éšªåˆ©ç‡ (ç¾å‚µ 4%)ï¼Œæ‰å…·å‚™æŠ•è³‡åƒ¹å€¼ã€‚"},
                            {sub:"ç‡’éŒ¢ç‡ (Burn Rate)", txt:"ç¾é‡‘é¤˜é¡ / æ¯æœˆè²  FCFã€‚è¨ˆç®—æ–°å‰µå…¬å¸é‚„èƒ½æ´»å¹¾å€‹æœˆ (Runway)ã€‚"},
                            {sub:"ç²åˆ©å“è³ª", txt:"è‹¥æ·¨åˆ© >> OCFï¼Œä»£è¡¨è³ºçš„éƒ½æ˜¯æ¬ æ¢ (æ‡‰æ”¶å¸³æ¬¾)ï¼Œå“è³ªæ¥µå·®ã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„äºŒï¼šä¼°å€¼æ¨¡å‹å·¥ç¨‹ ---
            {
                id: 2, type: 'study', title: "æ¨¡çµ„äºŒï¼šä¼°å€¼æ¨¡å‹å·¥ç¨‹ (Valuation)", desc: "åƒ¹æ ¼æ˜¯ä½ ä»˜å‡ºçš„ï¼Œåƒ¹å€¼æ˜¯ä½ å¾—åˆ°çš„ã€‚ç”¨æ•¸å­¸ç®—å‡ºå®‰å…¨é‚Šéš›ã€‚",
                cards: [
                    { 
                        title: "DCF ç¾é‡‘æµæŠ˜ç¾", tag: "ä¸Šå¸å…¬å¼", 
                        intro: "Value = Î£ [ FCF / (1 + WACC)^t ] + Terminal Valueã€‚",
                        details: [
                            {sub:"WACC (æŠ˜ç¾ç‡)", txt:"ä»£è¡¨é¢¨éšªã€‚å‡æ¯å°è‡´ WACC è®Šå¤§ï¼Œåˆ†æ¯è®Šå¤§ï¼Œä¼°å€¼é›ªå´© (å°¤å…¶æ˜¯æˆé•·è‚¡)ã€‚"},
                            {sub:"çµ‚å€¼ (Terminal Value)", txt:"ä½”ä¼°å€¼çš„ 70%ã€‚å°ã€Œæ°¸çºŒæˆé•·ç‡ (g)ã€æ¥µåº¦æ•æ„Ÿï¼Œå¾®èª¿ 1% ç›®æ¨™åƒ¹ç¿»å€ï¼Œæ˜¯åˆ†æå¸«é€ å‡é‡ç½å€ã€‚"},
                            {sub:"åå‘ DCF", txt:"åæ¨ã€Œç›®å‰è‚¡åƒ¹éš±å«çš„æˆé•·ç‡ã€ã€‚è‹¥å¸‚å ´éš±å«æˆé•·ç‡ 50% ä½†ä½ èªç‚ºåªæœ‰ 20%ï¼Œå‰‡é«˜ä¼°ã€‚"}
                        ]
                    },
                    { 
                        title: "SaaS ä¼°å€¼ (Rule of 40)", tag: "è»Ÿé«”è‚¡", 
                        intro: "é«˜æˆé•·è»Ÿé«”è‚¡å°ˆç”¨æ¨¡å‹ã€‚",
                        details: [
                            {sub:"Rule of 40", txt:"ç‡Ÿæ”¶æˆé•·ç‡ + FCF Margin â‰¥ 40%ã€‚é«˜æˆé•·å¯å®¹å¿è™§æï¼Œä½æˆé•·å¿…é ˆé«˜ç²åˆ©ã€‚"},
                            {sub:"LTV / CAC", txt:"å®¢æˆ¶çµ‚èº«åƒ¹å€¼ / ç²å®¢æˆæœ¬ã€‚å¿…é ˆ > 3ã€‚è‹¥ < 1 ä»£è¡¨è¶Šæˆé•·è³ è¶Šå¿«ã€‚"},
                            {sub:"æ·¨ç•™å­˜ç‡ (NDR)", txt:"è‹¥ > 120%ï¼Œä»£è¡¨èˆŠå®¢æˆ¶è¶Šè²·è¶Šå¤šï¼Œè¤‡åˆ©æ•ˆæ‡‰æ¥µå¼·ã€‚"}
                        ]
                    },
                    { 
                        title: "PEG Ratio", tag: "æˆé•·ä¿®æ­£", 
                        intro: "PEG = PE / G (é ä¼°æˆé•·ç‡)ã€‚ä¿®æ­£ PE ç„¡æ³•åæ‡‰æˆé•·çš„ç¼ºé™·ã€‚",
                        details: [
                            {sub:"åˆ¤è®€", txt:"PEG < 0.75 ä½ä¼°ï¼›PEG = 1 åˆç†ï¼›PEG > 1.5 é«˜ä¼°ã€‚"},
                            {sub:"é™·é˜±", txt:"G å¿…é ˆç”¨æœªä¾† 3-5 å¹´ CAGR çš„ä¿å®ˆä¼°è¨ˆï¼Œä¸å¯ç·šæ€§å¤–æ¨å»å¹´çš„é«˜æˆé•·ã€‚"}
                        ]
                    },
                    { 
                        title: "æœé‚¦åˆ†ææ³•", tag: "ROE æ‹†è§£", 
                        intro: "å°‡ ROE æ‹†è§£ç‚ºï¼šæ·¨åˆ©ç‡ Ã— å‘¨è½‰ç‡ Ã— æ¬Šç›Šä¹˜æ•¸ (æ§“æ¡¿)ã€‚",
                        details: [
                            {sub:"æ·¨åˆ©ç‡", txt:"ç”¢å“ç«¶çˆ­åŠ› (Apple)ã€‚"},
                            {sub:"å‘¨è½‰ç‡", txt:"ç®¡ç†æ•ˆç‡ (Costco)ã€‚"},
                            {sub:"æ¬Šç›Šä¹˜æ•¸", txt:"è²¡å‹™æ§“æ¡¿ (éŠ€è¡Œ)ã€‚è‹¥ ROE å‡é«˜ç´”é æ§“æ¡¿ï¼Œæ˜¯è™›èƒ–é¢¨éšªã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„ä¸‰ï¼šé‡åŒ–æŠ€è¡“åˆ†æ ---
            {
                id: 3, type: 'study', title: "æ¨¡çµ„ä¸‰ï¼šé‡åŒ–æŠ€è¡“åˆ†æ (Quant)", desc: "K ç·šæ˜¯æ‹è³£ç´€éŒ„ï¼ŒæŒ‡æ¨™æ˜¯åƒ¹æ ¼çš„å¾®åˆ†ã€‚ä¸çœ‹åœ–èªªæ•…äº‹ï¼Œçœ‹çµ±è¨ˆåˆ†ä½ˆã€‚",
                cards: [
                    { 
                        title: "RSI èˆ‡èƒŒé›¢", tag: "ä¸€éšå°æ•¸", 
                        intro: "RSI æ˜¯åƒ¹æ ¼çš„é€Ÿåº¦ã€‚èƒŒé›¢ (Divergence) æ˜¯æ…£æ€§åè½‰è¨Šè™Ÿã€‚",
                        details: [
                            {sub:"é ‚éƒ¨èƒŒé›¢", txt:"åƒ¹éé«˜ï¼ŒæŒ‡æ¨™ä¸éé«˜ ğŸ‘‰ å‹•èƒ½è¡°ç«­ (è»Šå­æ»‘è¡Œä½†æ²¹é–€é¬†äº†)ï¼Œåšç©ºã€‚"},
                            {sub:"éš±æ€§èƒŒé›¢", txt:"è¶¨å‹¢å›æª”è¨Šè™Ÿã€‚åƒ¹æœªç ´ä½ï¼ŒæŒ‡æ¨™ç ´ä½ ğŸ‘‰ é †å‹¢è²·é€²ã€‚"},
                            {sub:"éˆåŒ–", txt:"å¼·å‹¢å¤šé ­ RSI > 80 æ˜¯å¸¸æ…‹ã€‚è·Œç ´ 70 æ‰æ˜¯å‡ºå ´é»ã€‚"}
                        ]
                    },
                    { 
                        title: "å¸ƒæ—é€šé“æ“ å£“", tag: "æ³¢å‹•ç‡", 
                        intro: "Bandwidth ç¸®åˆ°æ¥µè‡´ = æš´é¢¨é›¨å‰çš„å¯§éœã€‚",
                        details: [
                            {sub:"åŸç†", txt:"èƒ½é‡å®ˆæ†ã€‚ä½æ³¢å‹•å¿…è½‰åŒ–ç‚ºé«˜æ³¢å‹•ã€‚"},
                            {sub:"ç­–ç•¥", txt:"ç­‰å¾…å¯¦é«” K ç·šçªç ´ä¸Šè»Œæˆ–è·Œç ´ä¸‹è»Œï¼Œé †å‹¢è¿½åƒ¹ (Momentum)ã€‚"},
                            {sub:"å¤šé ­é™·é˜±", txt:"çªç ´ä¸Šè»Œå¾Œéš¨å³è·Œå›é€šé“å…§ ğŸ‘‰ å‡çªç ´ï¼Œåšç©ºå‹ç‡æ¥µé«˜ã€‚"}
                        ]
                    },
                    { 
                        title: "æˆäº¤é‡åˆ†ä½ˆ (Volume Profile)", tag: "ç±Œç¢¼æˆ°å ´", 
                        intro: "çœ‹ã€Œå“ªå€‹åƒ¹æ ¼ã€æˆäº¤æœ€å¤šï¼Œè€Œéå“ªå€‹æ™‚é–“ã€‚",
                        details: [
                            {sub:"POC (æ§åˆ¶é»)", txt:"æˆäº¤é‡æœ€å¤§çš„åƒ¹æ ¼ã€‚å…·æœ‰å¼·å¤§ç£å¸åŠ›ã€‚"},
                            {sub:"HVN/LVN", txt:"é«˜é‡å€æ˜¯æ”¯æ’/å£“åŠ›ï¼›ä½é‡å€(çœŸç©ºå€)åƒ¹æ ¼æœƒå¿«é€Ÿé€šéã€‚"}
                        ]
                    },
                    { 
                        title: "MACD æŸ±ç‹€åœ–", tag: "äºŒéšå°æ•¸", 
                        intro: "MACD æŸ±ç‹€åœ–ä»£è¡¨ã€ŒåŠ é€Ÿåº¦ã€ã€‚",
                        details: [
                            {sub:"åŠ é€Ÿåº¦ç‚ºè² ", txt:"åƒ¹æ ¼é‚„åœ¨æ¼²ï¼Œä½†ç´…æŸ±è®ŠçŸ­ ğŸ‘‰ æ¼²é€Ÿè®Šæ…¢ï¼Œæº–å‚™åè½‰ã€‚"},
                            {sub:"é›¶è»¸äº¤æ˜“", txt:"DIF å›æ¸¬é›¶è»¸ä¸ç ´å†æ¬¡é‡‘å‰ (æµ·è±šè·³)ï¼Œæ˜¯ä¸»å‡æ®µè¨Šè™Ÿã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„å››ï¼šç¸½é«”ç¶“æ¿Ÿ ---
            {
                id: 4, type: 'study', title: "æ¨¡çµ„å››ï¼šç¸½é«”ç¶“æ¿Ÿ (Macro)", desc: "Fed æ˜¯èŠå®¶ã€‚çœ‹æ‡‚æµå‹•æ€§å…¬å¼èˆ‡æ®–åˆ©ç‡æ›²ç·šã€‚",
                cards: [
                    { 
                        title: "Fed æµå‹•æ€§å…¬å¼", tag: "è³‡é‡‘æ°´é¾é ­", 
                        intro: "Net Liquidity = Fed è³‡ç”¢è² å‚µè¡¨ - TGA - RRPã€‚",
                        details: [
                            {sub:"TGA (è²¡æ”¿éƒ¨å¸³æˆ¶)", txt:"æ”¿åºœèŠ±éŒ¢ (TGAä¸‹é™) = é‡‹æ”¾æµå‹•æ€§ã€‚"},
                            {sub:"RRP (é€†å›è³¼)", txt:"è³‡é‡‘è“„æ°´æ± ã€‚RRP ä¸‹é™ = è³‡é‡‘æµå›å¸‚å ´ (åˆ©å¤š)ã€‚"},
                            {sub:"QT (ç¸®è¡¨)", txt:"æ¯æœˆæŠ½èµ° 950 å„„æµå‹•æ€§ï¼Œæ¯”å‡æ¯æ›´å¯æ€•çš„éš±å½¢æ®ºæ‰‹ã€‚"}
                        ]
                    },
                    { 
                        title: "æ®–åˆ©ç‡å€’æ›", tag: "è¡°é€€æŒ‡æ¨™", 
                        intro: "çŸ­å‚µåˆ©ç‡ > é•·å‚µåˆ©ç‡ (10Y-2Y < 0)ã€‚å‹ç‡ 100% çš„è¡°é€€é è¨€ã€‚",
                        details: [
                            {sub:"ç‰©ç†æ„ç¾©", txt:"å¸‚å ´é æœŸæœªä¾†ç¶“æ¿Ÿå´©æ½°ï¼Œè³‡é‡‘æ¹§å…¥é•·å‚µé¿éšªã€‚"},
                            {sub:"å±éšªæ™‚åˆ»", txt:"å€’æ›ã€ŒçµæŸã€è½‰æ­£æ™‚ (Re-steepening)ï¼Œä»£è¡¨è¡°é€€ç¢ºå¯¦ç™¼ç”Ÿï¼ŒFed ææ…Œé™æ¯ï¼Œè‚¡å¸‚é€šå¸¸åœ¨æ­¤æ™‚å´©ç›¤ã€‚"}
                        ]
                    },
                    { 
                        title: "ç¾å…ƒå¾®ç¬‘æ›²ç·š", tag: "åŒ¯ç‡", 
                        intro: "ç¾å…ƒåœ¨ã€Œæ¥µå¥½ã€å’Œã€Œæ¥µå£ã€æ™‚éƒ½æœƒæ¼²ã€‚",
                        details: [
                            {sub:"é¿éšªæ¨¡å¼", txt:"å…¨çƒææ…Œ ğŸ‘‰ è²·ç¾å…ƒ (Cash is King)ã€‚"},
                            {sub:"æˆé•·æ¨¡å¼", txt:"ç¾åœ‹ç¨å¼· ğŸ‘‰ è²·ç¾å…ƒ (è³ºåˆ©æ¯)ã€‚"},
                            {sub:"ç–²è»Ÿæ¨¡å¼", txt:"å…¨çƒåŒæ­¥å¾©ç”¦ ğŸ‘‰ è³‡é‡‘æµå‡ºç¾å…ƒï¼Œæ–°èˆˆå¸‚å ´å¤§æ¼²ã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„äº”ï¼šç±Œç¢¼åšå¼ˆ ---
            {
                id: 5, type: 'study', title: "æ¨¡çµ„äº”ï¼šç±Œç¢¼åšå¼ˆ (PvP)", desc: "é›¶å’ŒéŠæˆ²ã€‚ä¸»åŠ›å¦‚ä½•åˆ©ç”¨æµå‹•æ€§çµæ®ºæ•£æˆ¶ã€‚",
                cards: [
                    { 
                        title: "Gamma Squeeze", tag: "è»‹ç©º", 
                        intro: "æ•£æˆ¶è²· Call é€¼è¿«åšå¸‚å•†è²·ç¾è²¨çš„æ•¸å­¸æ©Ÿåˆ¶ã€‚",
                        details: [
                            {sub:"Delta å°æ²–", txt:"åšå¸‚å•†è³£ Call çµ¦ä½ ï¼Œå¿…é ˆè²·ç¾è²¨é¿éšªã€‚"},
                            {sub:"Gamma åŠ é€Ÿ", txt:"è‚¡åƒ¹æ¼² -> Delta è®Šå¤§ -> åšå¸‚å•†è²·æ›´å¤šç¾è²¨ -> è‚¡åƒ¹æ›´æ¼²ã€‚æ­£å›é¥‹å¾ªç’° (å¦‚ GME äº‹ä»¶)ã€‚"}
                        ]
                    },
                    { 
                        title: "æµå‹•æ€§çµæ®º", tag: "è¨‚å–®æµ", 
                        intro: "ä¸»åŠ›è³‡é‡‘å¤§ï¼Œå¿…é ˆå°‹æ‰¾å°æ‰‹ç›¤ã€‚",
                        details: [
                            {sub:"æ­¢æçµæ®º (Stop Run)", txt:"æ•…æ„æ®ºç ´æ”¯æ’ä½ï¼Œè§¸ç™¼æ•£æˆ¶çš„åœæè³£å–® (æä¾›æµå‹•æ€§)ï¼Œä¸»åŠ›è¶æ©Ÿå¤§èˆ‰å¸ç±Œã€‚"},
                            {sub:"å‡çªç ´ (Fakeout)", txt:"çªç ´å£“åŠ›å¸å¼•è¿½åƒ¹è²·ç›¤ï¼Œç„¶å¾Œå€’è²¨åæ®ºã€‚"}
                        ]
                    },
                    { 
                        title: "å‡±åˆ©å…¬å¼", tag: "è³‡é‡‘æ§ç®¡", 
                        intro: "f = (bp - q) / bã€‚æœ€ä½³ä¸‹æ³¨æ¯”ä¾‹ã€‚",
                        details: [
                            {sub:"æ‡‰ç”¨", txt:"æ°¸é ä¸è¦ All-inã€‚åƒæ•¸é«˜ä¼°æœƒå°è‡´ç ´ç”¢ã€‚"},
                            {sub:"åŠå‡±åˆ©", txt:"å¯¦æˆ°ä¸­åªä¸‹æ³¨å‡±åˆ©å»ºè­°å€¼çš„ 1/2ï¼Œä»¥é˜²é»‘å¤©éµã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„å…­ï¼šè³‡ç”¢é…ç½® ---
            {
                id: 6, type: 'study', title: "æ¨¡çµ„å…­ï¼šè³‡ç”¢é…ç½® (Portfolio)", desc: "å…è²»çš„åˆé¤ã€‚åˆ©ç”¨å”æ–¹å·®çŸ©é™£å°æ²–é¢¨éšªã€‚",
                cards: [
                    { 
                        title: "å…¨å¤©å€™ç­–ç•¥", tag: "Risk Parity", 
                        intro: "æ©‹æ°´åŸºé‡‘ç­–ç•¥ã€‚è®“è‚¡ç¥¨å’Œå‚µåˆ¸çš„ã€Œé¢¨éšªè²¢ç»ã€ç›¸ç­‰ã€‚",
                        details: [
                            {sub:"é‚è¼¯", txt:"è‚¡ç¥¨æ³¢å‹•æ˜¯å‚µåˆ¸çš„ 4 å€ã€‚æ‰€ä»¥å‚µåˆ¸é…ç½®é‡‘é¡è¦æ˜¯è‚¡ç¥¨çš„ 4 å€ (ä¸¦é–‹æ§“æ¡¿)ã€‚"},
                            {sub:"å››è±¡é™", txt:"å¹³è¡¡é…ç½®æ–¼ï¼šé«˜æˆé•·ã€ä½æˆé•·ã€é«˜é€šè†¨ã€ä½é€šè†¨å››ç¨®ç’°å¢ƒã€‚"}
                        ]
                    },
                    { 
                        title: "å†å¹³è¡¡ (Rebalancing)", tag: "ç´€å¾‹", 
                        intro: "å¼·è¿«è²·ä½è³£é«˜çš„æ•¸å­¸æ©Ÿåˆ¶ã€‚",
                        details: [
                            {sub:"å¤è¾²æƒ¡é­”", txt:"é€éå®šæœŸå†å¹³è¡¡ï¼Œå¯ä»¥è®“éš¨æ©Ÿæ³¢å‹•çš„è³‡ç”¢çµ„ç”¢ç”Ÿæ­£å ±é…¬ã€‚"},
                            {sub:"é–¾å€¼å†å¹³è¡¡", txt:"ç•¶è‚¡å‚µæ¯”åé›¢ >5% æ™‚è§¸ç™¼ï¼Œå„ªæ–¼å®šæœŸå†å¹³è¡¡ã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„ä¸ƒï¼šè¡Œç‚ºé‡‘è ---
            {
                id: 7, type: 'study', title: "æ¨¡çµ„ä¸ƒï¼šè¡Œç‚ºé‡‘è (Psychology)", desc: "å¤§è…¦çš„ Bugã€‚å±•æœ›ç†è«–èˆ‡èªçŸ¥åèª¤ã€‚",
                cards: [
                    { 
                        title: "å±•æœ›ç†è«–", tag: "æå¤±å­æƒ¡", 
                        intro: "è³ éŒ¢çš„ç—›è‹¦æ˜¯è³ºéŒ¢å¿«æ¨‚çš„ 2.5 å€ã€‚",
                        details: [
                            {sub:"ç¢ºå®šæ€§æ•ˆæ‡‰", txt:"è³ºéŒ¢æ™‚å­æƒ¡é¢¨éšª ğŸ‘‰ å¤ªæ—©è³£ã€‚"},
                            {sub:"åå°„æ•ˆæ‡‰", txt:"è³ éŒ¢æ™‚åå¥½é¢¨éšª (è³­å¾’å¿ƒæ…‹) ğŸ‘‰ æ­»æŠ±å‡¹å–®ã€‚"},
                            {sub:"è§£æ³•", txt:"ç¨‹å¼åŒ–åœæï¼Œä¸è®“æƒ…ç·’ä»‹å…¥ã€‚"}
                        ]
                    },
                    { 
                        title: "ç¢ºèªåèª¤", tag: "åŒæº«å±¤", 
                        intro: "åªçœ‹æƒ³çœ‹çš„è³‡è¨Šã€‚",
                        details: [
                            {sub:"è§£æ³•", txt:"ç´…éšŠæ¸¬è©¦ (Red Team)ã€‚å¼·è¿«è‡ªå·±å¯«ä¸‹ 3 å€‹ã€Œè³£å‡ºç†ç”±ã€ã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„å…«ï¼šWeb3 ---
            {
                id: 8, type: 'study', title: "æ¨¡çµ„å…«ï¼šWeb3 é‡‘è (Crypto)", desc: "Code is Lawã€‚24/7 çš„æ¼”ç®—æ³•è³­å ´ã€‚",
                cards: [
                    { 
                        title: "AMM è‡ªå‹•åšå¸‚å•†", tag: "DeFi", 
                        intro: "x * y = kã€‚æ²’æœ‰æ›å–®çš„æ•¸å­¸å®šåƒ¹ã€‚",
                        details: [
                            {sub:"ç„¡å¸¸æå¤± (IL)", txt:"æµå‹•æ€§æä¾›è€…çš„é¢¨éšªã€‚æœ¬è³ªæ˜¯åšç©ºæ³¢å‹•ç‡ã€‚"},
                            {sub:"é–ƒé›»è²¸", txt:"åŒä¸€å€å¡Šå…§å€Ÿé‚„æ¬¾ã€‚é›¶æœ¬é‡‘å¥—åˆ©çš„æ¥µè‡´ã€‚"}
                        ]
                    },
                    { 
                        title: "æ¯”ç‰¹å¹£ä¼°å€¼", tag: "æ•¸ä½é»ƒé‡‘", 
                        intro: "æ¢…ç‰¹å¡å¤«å®šå¾‹èˆ‡ S2F æ¨¡å‹ã€‚",
                        details: [
                            {sub:"S2F", txt:"ç¨€ç¼ºæ€§é©…å‹•åƒ¹æ ¼ã€‚ç”¢é‡æ¸›åŠå°è‡´ä¾›çµ¦è¡æ“Šã€‚"},
                            {sub:"Hashrate", txt:"ç®—åŠ›å³æ­£ç¾©ã€‚åƒ¹æ ¼é•·æœŸè·Ÿéš¨ç®—åŠ›æˆæœ¬ã€‚"}
                        ]
                    }
                ]
            },

             // --- ğŸŸ¢ æ¨¡çµ„ä¹ï¼šé‡‘èè¡ç”Ÿå“ ---
            {
                id: 9, type: 'study', title: "æ¨¡çµ„ä¹ï¼šè¡ç”Ÿæ€§å•†å“ (Derivatives)", desc: "é›™é¢åˆƒã€‚ç”¨å¾—å¥½æ˜¯ä¿éšªï¼Œç”¨ä¸å¥½æ˜¯è³­åšã€‚",
                cards: [
                    { 
                        title: "æœŸè²¨ (Futures)", tag: "é«˜æ§“æ¡¿", 
                        intro: "ä¿è­‰é‡‘äº¤æ˜“ã€‚ç”¨ 1 å…ƒåš 10 å…ƒç”Ÿæ„ã€‚",
                        details: [
                            {sub:"æ­£é€†åƒ¹å·®", txt:"æœŸè²¨èˆ‡ç¾è²¨çš„åƒ¹æ ¼å·®è·ï¼Œçµç®—æ—¥å¿…æ”¶æ–‚ã€‚å¯åšç„¡é¢¨éšªå¥—åˆ©ã€‚"},
                            {sub:"æ–·é ­", txt:"ç¶­æŒç‡ä¸è¶³å¼·åˆ¶å¹³å€‰ã€‚æœŸè²¨é¢¨éšªåœ¨æ–¼æ§“æ¡¿ï¼Œè€Œéæ³¢å‹•ã€‚"}
                        ]
                    },
                    { 
                        title: "é¸æ“‡æ¬Š (Options)", tag: "éç·šæ€§", 
                        intro: "è²·æ–¹ç²åˆ©ç„¡é™é¢¨éšªæœ‰é™ï¼›è³£æ–¹ç²åˆ©æœ‰é™é¢¨éšªç„¡é™ã€‚",
                        details: [
                            {sub:"Greeks", txt:"Delta(æ–¹å‘)ã€Gamma(åŠ é€Ÿ)ã€Theta(æ™‚é–“)ã€Vega(æ³¢å‹•)ã€‚"},
                            {sub:"Covered Call", txt:"æŒæœ‰ç¾è‚¡è³£è²·æ¬Šã€‚æ”¶ç§Ÿç­–ç•¥ï¼Œé™ä½æŒè‚¡æˆæœ¬ã€‚"}
                        ]
                    }
                ]
            },

            // --- ğŸŸ¢ æ¨¡çµ„åï¼šäººç”Ÿæ¨¡æ“¬å¯¦æˆ° ---
            {
                id: 10, type: 'game', title: "æ¨¡çµ„åï¼šäººç”Ÿæ¨¡æ“¬å¯¦æˆ° (æœ€çµ‚è©¦ç…‰)", desc: "æ¨¡æ“¬æœªä¾† 10 å¹´çš„æ±ºç­–ï¼Œçœ‹çœ‹ä½ æ˜¯å¦èƒ½é¿é–‹äººæ€§é™·é˜±ï¼Œå¯¦ç¾è²¡å¯Œè‡ªç”±ã€‚", startScene: 'start'
            }
        ];

        // ==========================================
        // ğŸ® éŠæˆ²è…³æœ¬æ•¸æ“š (Game Data)
        // ==========================================
        const gameScenes = {
            'start': {
                icon: 'ğŸ“', text: 'å‰›ç•¢æ¥­èµ·è–ª 3.5 è¬ï¼Œæ‰‹ä¸Šæœ‰ 10 è¬ç©è“„ã€‚ç¬¬ä¸€å€‹æœˆç™¼è–ªæ°´æ€éº¼è¾¦ï¼Ÿ',
                choices: [
                    { txt: 'è²· iPhoneã€åƒå¤§é¤ (èŠ±æ‰ 3 è¬)', next: 'scene_2', money: -30000, msg: 'äº«å—ç•¶ä¸‹ï¼Œä½†ç©è“„ç¬é–“å°‘äº† 30%ã€‚' },
                    { txt: 'åŸ·è¡Œ 631 æ³•å‰‡ (å­˜ä¸‹ 30%)', next: 'scene_2', money: 5000, msg: 'å¿ä½æ…¾æœ›ï¼Œå­˜ä¸‹ç¬¬ä¸€æ¡¶é‡‘ã€‚' }
                ]
            },
            'scene_2': {
                icon: 'ğŸš—', text: '25 æ­²ï¼ŒåŒäº‹éƒ½è²·è»Šäº†ï¼Œä½ ä¹Ÿæƒ³è²·ä¸€å° 70 è¬çš„æ–°è»Šã€‚',
                choices: [
                    { txt: 'è²·ï¼åˆ†æœŸä»˜æ¬¾ä¹Ÿè¦è²·', next: 'car_path', money: -200000, msg: 'è²·äº†æ–°è»Šï¼ä½†æ¯å€‹æœˆå¤šäº†è»Šè²¸é¤Šè»Šè²»ï¼Œç¾é‡‘æµåƒç·Šã€‚' },
                    { txt: 'å¿ä½ï¼Œé¨æ©Ÿè»Šï¼ŒéŒ¢æ‹¿å»æŠ•è³‡', next: 'invest_path', money: 0, msg: 'é¿é–‹äº†è² å‚µï¼Œä¿ç•™æŠ•è³‡æœ¬é‡‘ã€‚' }
                ]
            },
            'car_path': {
                icon: 'ğŸ“‰', text: 'è²·è»Šå¾Œä¸€å¹´è¢«è£å“¡ï¼å¤±å»æ”¶å…¥ä½†è»Šè²¸ç…§ç¹³ã€‚',
                choices: [
                    { txt: 'æ²’å‚™ç”¨é‡‘ï¼Œåªèƒ½ä¿¡è²¸', next: 'bad_end', money: -100000, msg: 'å‚µå‹™è¶Šæ»¾è¶Šå¤§ã€‚' },
                    { txt: 'å¿ç—›è³£è»Šæ±‚ç¾', next: 'scene_3', money: 400000, msg: 'æ–°è»Šè½åœ°æ‰“æŠ˜ï¼Œè™§äº†å¹¾åè¬ä½†è§£æ±ºå±æ©Ÿã€‚' }
                ]
            },
            'invest_path': {
                icon: 'ğŸ“ˆ', text: 'éŒ¢æŠ•å…¥è‚¡å¸‚ï¼Œçµæœé‡åˆ°é‡‘èæµ·å˜¯ï¼Œå¸³é¢è™§æ 40%ï¼',
                choices: [
                    { txt: 'åš‡æ­»äº†ï¼Œè³£æ‰æ­¢æ (æå¤±è¶¨é¿)', next: 'scene_3', money: -100000, msg: 'åœ¨æœ€ä½é»è³£å‡ºï¼Œå¯¦ç¾è™§æã€‚' },
                    { txt: 'ç›¸ä¿¡åŸºæœ¬é¢ï¼Œç¹¼çºŒæŒæœ‰', next: 'rich_path', money: 0, msg: 'å¿ä½ææ…Œã€‚é€™éœ€è¦æ¥µå¤§çš„å¿ƒç†ç´ è³ªã€‚' }
                ]
            },
            'rich_path': {
                icon: 'ğŸ’°', text: '35 æ­²ï¼Œè³‡ç”¢çªç ´ 500 è¬ã€‚é€™æ™‚æ–°èç‹‚å ±ã€Œå…¨çƒç¶“æ¿Ÿå´©ç›¤ã€...',
                choices: [
                    { txt: 'æˆ‘æœ‰åšè³‡ç”¢é…ç½®ï¼Œä¸ç†æœƒ', next: 'market_crash_test', money: 0, msg: 'çœŸæ­£çš„è€ƒé©—ç¾åœ¨æ‰é–‹å§‹ã€‚' }
                ]
            },
            'market_crash_test': {
                icon: 'ğŸ“‰', text: 'ã€ç³»çµ±å»£æ’­ã€‘å²è©©ç´šå´©ç›¤ï¼æ–°èæ¯å¤©éƒ½å ±ä¸–ç•Œæœ«æ—¥ï¼Œä½ çš„æœ‹å‹éƒ½åœ¨æ‹‹å”®ï¼Œä½ è©²æ€éº¼è¾¦ï¼Ÿ',
                choices: [
                    { txt: 'è·Ÿè‘—è³£æ‰ (å¾çœ¾å¿ƒç†)', next: 'panic_sell', money: -500000, msg: 'ä½ å› ç‚ºææ…Œè€Œè³£åœ¨ä½é»ã€‚' },
                    { txt: 'å‹•ç”¨å‚™ç”¨é‡‘åŠ ç¢¼ (è²ªå©ª)', next: 'aggressive_buy', money: 0, msg: 'å¤§è†½æ¥åˆ€ï¼Œé¢¨éšªæ¥µé«˜ã€‚' },
                    { txt: 'é—œæ‰æ–°èï¼Œåˆªæ‰ APPï¼Œå»å…¬åœ’æ•£æ­¥', next: 'hold_on', money: 0, msg: 'ä½ é¸æ“‡äº†ã€Œå¿½è¦–çŸ­æœŸæ³¢å‹•ã€ã€‚' }
                ]
            },
            'panic_sell': { icon: 'ğŸ’¸', text: 'è³£å…‰å¾Œè‚¡å¸‚ V å‹åè½‰å‰µæ–°é«˜ï¼Œä½ åªèƒ½çœ‹è‘—åˆ¥äººè³ºéŒ¢ã€‚', choices: [{ txt: 'å­¸åˆ°ä¸€èª²', next: 'start', money: 0, msg: 'é€™å ‚èª²å¾ˆè²´ã€‚' }] },
            'hold_on': { icon: 'ğŸ§˜', text: 'ä¸€å¹´éå»äº†ã€‚å¸‚å ´å›åˆ°äº†èµ·è·Œé»ï¼Œç”šè‡³é‚„æ¼²äº†ä¸€äº›ã€‚ä½ ä»€éº¼éƒ½æ²’åšï¼Œä½†ä½ çš„è³‡ç”¢æ¯”é‚£äº›å¿™é€²å¿™å‡ºçš„äººéƒ½å¤šã€‚', choices: [{ txt: 'é€™å°±æ˜¯ã€Œéˆæ„ŸåŠ›ã€çš„å‹åˆ©', next: 'happy_end', money: 200000, msg: 'æŠ•è³‡æ˜¯ä¸€å ´é¦¬æ‹‰æ¾ã€‚' }] },
            'aggressive_buy': { icon: 'ğŸ°', text: 'é‹æ°£å¥½å¸‚å ´è¦‹åº•ï¼Œä½ å¤§è³ºä¸€ç­†ã€‚ä½†ä¸‹æ¬¡å¯èƒ½å°±æ²’é€™éº¼å¥½é‹ã€‚', choices: [{ txt: 'è¦‹å¥½å°±æ”¶', next: 'happy_end', money: 1000000, msg: 'å¯Œè²´éšªä¸­æ±‚ã€‚' }] },
            'scene_3': { icon: 'ğŸ˜', text: '35 æ­²ï¼Œè³‡ç”¢å¹³å¹³ã€‚', choices: [{ txt: 'é‡æ–°é–‹å§‹', next: 'start', money: 0, msg: 'é‡ä¾†ä¸€æ¬¡ã€‚' }] },
            'bad_end': { icon: 'ğŸ’¸', text: 'ç ´ç”¢çµå±€ã€‚', choices: [{ txt: 'é‡æ–°æŒ‘æˆ°', next: 'start', money: 0, msg: 'è¨˜å¾—å­˜å‚™ç”¨é‡‘ï¼' }] },
            'happy_end': { icon: 'ğŸ†', text: 'è²¡å¯Œè‡ªç”±çµå±€ï¼ä½ å…‹æœäº†äººæ€§ï¼Œè®“è¤‡åˆ©ç‚ºä½ å·¥ä½œã€‚', choices: [{ txt: 'å†ç©ä¸€æ¬¡', next: 'start', money: 0, msg: 'æ­å–œï¼' }] }
        };

        // ==========================================
        // âš™ï¸ æ ¸å¿ƒé‹ä½œé‚è¼¯ (App Logic)
        // ==========================================
        let currentModuleId = 1;
        let gameState = { money: 100000, scene: 'start' };

        function init() {
            renderSidebar();
            loadModule(1);
        }

        function renderSidebar() {
            const list = document.getElementById('moduleList');
            if (!list) return;
            list.innerHTML = '';
            curriculum.forEach(mod => {
                const li = document.createElement('li');
                li.className = `module-item ${mod.id === currentModuleId ? 'active' : ''}`;
                li.innerHTML = `<span>${mod.title}</span>`;
                li.onclick = () => loadModule(mod.id);
                list.appendChild(li);
            });
        }

        function loadModule(id) {
            currentModuleId = id;
            renderSidebar();
            const module = curriculum.find(m => m.id === id);
            const contentDiv = document.getElementById('contentArea');
            const toolsPanel = document.getElementById('toolsPanel');

            let html = `
                <div class="header-section">
                    <h2>${module.title}</h2>
                    <p>${module.desc}</p>
                </div>
            `;

            if (module.type === 'study') {
                html += `<div class="card-grid">`;
                module.cards.forEach((card, index) => {
                    html += `
                        <div class="flashcard" onclick="openDetail(${id}, ${index})">
                            <span class="tag">${card.tag}</span>
                            <h3 style="font-size:1.4rem; color:#334155;">${card.title}</h3>
                            <div class="click-hint">ğŸ‘† é»æ“Šçœ‹è©³è§£</div>
                        </div>
                    `;
                });
                html += `</div>`;
                if(toolsPanel) toolsPanel.style.display = 'grid';
            } else {
                html += `<div class="game-panel" id="gamePanel"></div>`;
                setTimeout(() => {
                    gameState = { money: 100000, scene: module.startScene };
                    renderGameScene(module.startScene);
                }, 0);
                if(toolsPanel) toolsPanel.style.display = 'none';
            }
            contentDiv.innerHTML = html;
        }

        function openDetail(moduleId, cardIndex) {
            const module = curriculum.find(m => m.id === moduleId);
            const card = module.cards[cardIndex];
            document.getElementById('modalTitle').innerText = card.title;
            const body = document.getElementById('modalBody');
            
            // æ§‹å»ºè©³ç´°å…§å®¹ HTML
            let detailHtml = '';
            if (card.intro) {
                detailHtml += `<div style="margin-bottom:20px; color:#475569; font-weight:500;">${card.intro}</div>`;
            }
            
            card.details.forEach(detail => {
                detailHtml += `
                    <div class="detail-block">
                        <div class="detail-title">ğŸ”¹ ${detail.sub}</div>
                        <div>${detail.txt}</div>
                    </div>
                `;
            });

            if (card.case) {
                 detailHtml += `
                    <div style="margin-top:20px; padding:15px; background:#fff7ed; border-left:4px solid #f97316; border-radius:4px;">
                        ${card.case.replace(/\n/g, '<br>')}
                    </div>
                `;
            }

            body.innerHTML = detailHtml;
            document.getElementById('detailModal').style.display = 'flex';
        }

        function closeModal(e) {
            document.getElementById('detailModal').style.display = 'none';
        }

        function renderGameScene(sceneId) {
            const scene = gameScenes[sceneId];
            const panel = document.getElementById('gamePanel');
            if (!panel) return;

            let html = `
                <div class="status-bar">
                    <div>è³‡ç”¢ï¼š<span class="status-val money">$${gameState.money.toLocaleString()}</span></div>
                </div>
                <div class="scene-content">
                    <div class="scene-icon">${scene.icon}</div>
                    <div class="scene-text">${scene.text}</div>
                    <div style="width:100%">
            `;
            scene.choices.forEach(choice => {
                html += `<button class="choice-btn" onclick="makeChoice('${choice.next}', ${choice.money}, '${choice.msg}')">${choice.txt}</button>`;
            });
            html += `</div></div>`;
            panel.innerHTML = html;
        }

        function makeChoice(nextScene, moneyChange, msg) {
            gameState.money += moneyChange;
            alert(msg);
            renderGameScene(nextScene);
        }

        function calculatePosition() {
            const total = parseFloat(document.getElementById('totalCapital').value);
            const risk = parseFloat(document.getElementById('riskPercent').value) / 100;
            const entry = parseFloat(document.getElementById('entryPrice').value);
            const stop = parseFloat(document.getElementById('stopLossPrice').value);

            if (!entry || !stop || entry <= stop) {
                document.getElementById('resultShares').innerText = "åƒ¹æ ¼éŒ¯èª¤";
                return;
            }
            const maxLoss = total * risk;
            const lossPerShare = entry - stop;
            const shares = Math.floor(maxLoss / lossPerShare);
            document.getElementById('resultShares').innerText = shares + " è‚¡";
        }

        async function askGemini() {
            const input = document.getElementById('userPrompt').value;
            const responseDiv = document.getElementById('aiResponse');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const API_KEY = apiKeyInput ? apiKeyInput.value.trim() : "";

            if (!input.trim()) { alert("è«‹è¼¸å…¥å•é¡Œï¼"); return; }
            if (!API_KEY) { alert("è«‹è¼¸å…¥ API Key å–”ï¼"); return; }

            responseDiv.style.display = 'block';
            responseDiv.innerHTML = "â³ AI æ­£åœ¨æ€è€ƒä¸­...";
            
            const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=" + API_KEY;
            const payload = {
                contents: [{
                    parts: [{ text: input + " (è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œä¸¦ä¸”åšç‚ºä¸€å€‹å°ˆæ¥­çš„ç†è²¡é¡§å•ï¼Œå›ç­”ç°¡çŸ­æœ‰åŠ›ä¸¦ç›¡å¯èƒ½å¤šè¦–è§’åˆ†æ)" }]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                
                if (data.error) {
                    responseDiv.innerHTML = `âŒ éŒ¯èª¤ï¼š${data.error.message}`;
                } else if (data.candidates && data.candidates[0].content) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    responseDiv.innerHTML = `<strong>ğŸ’¡ é¡§å•å»ºè­°ï¼š</strong><br>${aiText}`;
                } else {
                    responseDiv.innerHTML = "âŒ ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
                }
            } catch (error) {
                responseDiv.innerHTML = "âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Key æ˜¯å¦æ­£ç¢ºã€‚";
            }
        }

        // ğŸš€ å•Ÿå‹•ç¨‹å¼
        init();
    </script>
    </script>
</body>

</html>

